<?php
namespace App\Http\Controllers;
use Illuminate\Http\Request; use Illuminate\Support\Facades\Auth; use App\Models\Subject; use App\Models\Booking; use App\Models\User;
class HomeController extends Controller { public function index(){ $user = Auth::user(); if(!$user) return redirect()->route('login'); if($user->role=='admin'){ $totalUsers = User::count(); $totalBookings = Booking::count(); return view('admin.dashboard', compact('totalUsers','totalBookings')); } elseif($user->role=='tutor'){ $availabilities = $user->availabilities()->orderBy('date')->get(); $pendingBookings = Booking::whereHas('availability', function($q) use($user){ $q->where('user_id',$user->id); })->where('status','pending')->get(); return view('tutor.dashboard', compact('availabilities','pendingBookings')); } else { $subjects = Subject::all(); $myBookings = $user->bookingsAsTutee()->with('availability.tutor','availability')->get(); return view('tutee.dashboard', compact('subjects','myBookings')); } }}
